(function (root, factory) {
    if (typeof define === "function" && define.amd) {
        define(["d3", "q"], function(d3, Q){  // amd
            return (root.LocusZoom = factory(d3, Q));
        });
    } else if(typeof module === "object" && module.exports) {  // commonJS
        module.exports = (root.LocusZoom = factory(require("d3"), require("q")));
    } else {  // globals
        root.LocusZoom = factory(root.d3, root.Q);
    }
}(this, function(d3, Q) {

    var semanticVersionIsOk = function(minimum_version, current_version){
        // handle the trivial case
        if (current_version == minimum_version){ return true; }
        // compare semantic versions by component as integers
        var minimum_version_array = minimum_version.split(".");
        var current_version_array = current_version.split(".");
        var version_is_ok = false;
        minimum_version_array.forEach(function(d, i){
            if (!version_is_ok && +current_version_array[i] > +minimum_version_array[i]){
                version_is_ok = true;
            }
        });
        return version_is_ok;
    };

    try {

        // Verify dependency: d3.js
        var minimum_d3_version = "3.5.6";
        if (typeof d3 != "object"){
            throw new Error("d3 dependency not met. Library missing.");
        }
        if (!semanticVersionIsOk(minimum_d3_version, d3.version)){
            throw new Error("d3 dependency not met. Outdated version detected.\nRequired d3 version: " + minimum_d3_version + " or higher (found: " + d3.version + ").");
        }

        // Verify dependency: Q.js
        if (typeof Q != "function"){
            throw new Error("Q dependency not met. Library missing.");
        }

        // ESTemplate: module content goes here
        ;%= body %;

    } catch (plugin_loading_error){
        console.error("LocusZoom Plugin error: ", plugin_loading_error);
    }

    return LocusZoom;

}));
