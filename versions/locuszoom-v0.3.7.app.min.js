!function() {
    try {

        // Verify that the two third-party dependencies are met: d3 and Q
        var minimum_d3_version = "3.5.6";
        if (typeof d3 != "object"){
            throw("LocusZoom unable to load: d3 dependency not met. Library missing.");
        } else if (d3.version < minimum_d3_version){
            throw("LocusZoom unable to load: d3 dependency not met. Outdated version detected.\nRequired d3 version: " + minimum_d3_version + " or higher (found: " + d3.version + ").");
        }
        if (typeof Q != "function"){
            throw("LocusZoom unable to load: Q dependency not met. Library missing.");
        }
        
        var LocusZoom={version:"0.3.8"};LocusZoom.populate=function(e,t,o,n){if("undefined"==typeof e)throw"LocusZoom.populate selector not defined";if(d3.select(e).html(""),"undefined"!=typeof n){console.warn("Warning: state passed to LocusZoom.populate as fourth argument. This behavior is deprecated. Please include state as a parameter of layout");var i={state:n},r=o||{};o=LocusZoom.mergeLayouts(i,r)}var a;return d3.select(e).call(function(){if("undefined"==typeof this.node().id){for(var e=0;!d3.select("#lz-"+e).empty();)e++;this.attr("id","#lz-"+e)}if(a=new LocusZoom.Instance(this.node().id,t,o),"undefined"!=typeof this.node().dataset&&"undefined"!=typeof this.node().dataset.region){var n=LocusZoom.parsePositionQuery(this.node().dataset.region);Object.keys(n).forEach(function(e){a.state[e]=n[e]})}a.svg=d3.select("div#"+a.id).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("id",a.id+"_svg").attr("class","lz-locuszoom"),a.setDimensions(),a.initialize(),"object"==typeof t&&Object.keys(t).length&&a.refresh()}),a},LocusZoom.populateAll=function(e,t,o,n){var i=[];return d3.selectAll(e).each(function(e,r){i[r]=LocusZoom.populate(this,t,o,n)}),i},LocusZoom.positionIntToString=function(e){var t=Math.min(Math.max(6-Math.floor((Math.log(e)/Math.LN10).toFixed(9)),2),12);return""+(e/Math.pow(10,6)).toFixed(t)},LocusZoom.positionStringToInt=function(e){var t=e.toUpperCase();t=t.replace(/,/g,"");var o=/([KMG])[B]*$/,n=o.exec(t),i=1;return n&&(i="M"==n[1]?1e6:"G"==n[1]?1e9:1e3,t=t.replace(o,"")),t=Number(t)*i},LocusZoom.parsePositionQuery=function(e){var t=/^(\w+):([\d,.]+[kmgbKMGB]*)([-+])([\d,.]+[kmgbKMGB]*)$/,o=/^(\w+):([\d,.]+[kmgbKMGB]*)$/,n=t.exec(e);if(n){if("+"==n[3]){var i=LocusZoom.positionStringToInt(n[2]),r=LocusZoom.positionStringToInt(n[4]);return{chr:n[1],start:i-r,end:i+r}}return{chr:n[1],start:LocusZoom.positionStringToInt(n[2]),end:LocusZoom.positionStringToInt(n[4])}}return n=o.exec(e),n?{chr:n[1],position:LocusZoom.positionStringToInt(n[2])}:null},LocusZoom.prettyTicks=function(e,t,o){("undefined"==typeof o||isNaN(parseInt(o)))&&(o=5),o=parseInt(o);var n=o/3,i=.75,r=1.5,a=.5+1.5*r,s=Math.abs(e[0]-e[1]),l=s/o;Math.log(s)/Math.LN10<-2&&(l=Math.max(Math.abs(s))*i/n);var p=Math.pow(10,Math.floor(Math.log(l)/Math.LN10)),u=0;1>p&&0!=p&&(u=Math.abs(Math.round(Math.log(p)/Math.LN10)));var c=p;r*(l-c)>2*p-l&&(c=2*p,a*(l-c)>5*p-l&&(c=5*p,r*(l-c)>10*p-l&&(c=10*p)));for(var d=[],h=parseFloat((Math.floor(e[0]/c)*c).toFixed(u));h<e[1];)d.push(h),h+=c,u>0&&(h=parseFloat(h.toFixed(u)));return d.push(h),("undefined"==typeof t||-1==["low","high","both","neither"].indexOf(t))&&(t="neither"),("low"==t||"both"==t)&&d[0]<e[0]&&(d=d.slice(1)),("high"==t||"both"==t)&&d[d.length-1]>e[1]&&d.pop(),d},LocusZoom.createCORSPromise=function(e,t,o,n){var i=Q.defer(),r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r&&(r.onreadystatechange=function(){4===r.readyState&&(200===r.status||0===r.status?i.resolve(JSON.parse(r.responseText)):i.reject("HTTP "+r.status+" for "+t))},n&&setTimeout(i.reject,n),o="undefined"!=typeof o?o:"",r.send(o)),i.promise},LocusZoom.mergeLayouts=function(e,t){if("object"!=typeof e||"object"!=typeof t)throw"LocusZoom.mergeLayouts only accepts two layout objects; "+typeof e+", "+typeof t+" given";for(var o in t)if(t.hasOwnProperty(o)){var n=null==e[o]?"undefined":typeof e[o],i=typeof t[o];if("function"==n||"function"==i)throw"LocusZoom.mergeLayouts encountered an unsupported property type";"undefined"!=n?"object"!=n||"object"!=i||(e[o]=LocusZoom.mergeLayouts(e[o],t[o])):e[o]=JSON.parse(JSON.stringify(t[o]))}return e},LocusZoom.parseFields=function(e,t){if("object"!=typeof e)throw"LocusZoom.parseFields invalid arguments: data is not an object";if("string"!=typeof t)throw"LocusZoom.parseFields invalid arguments: html is not a string";var o;for(var n in e)e.hasOwnProperty(n)&&("string"==typeof e[n]||"number"==typeof e[n]||"boolean"==typeof e[n])&&(o=new RegExp("\\{\\{"+n.replace("|","\\|").replace(":","\\:")+"\\}\\}","g"),t=t.replace(o,e[n]));return t},LocusZoom.DefaultLayout={state:{},width:1,height:1,min_width:1,min_height:1,resizable:!1,aspect_ratio:1,panels:{}},LocusZoom.StandardLayout={state:{},width:800,height:450,min_width:400,min_height:225,resizable:"responsive",aspect_ratio:16/9,panels:{positions:{width:800,height:225,origin:{x:0,y:0},min_width:400,min_height:112.5,proportional_width:1,proportional_height:.5,proportional_origin:{x:0,y:0},margin:{top:20,right:20,bottom:35,left:50},inner_border:"rgba(210, 210, 210, 0.85)",axes:{x:{label_function:"chromosome",label_offset:32,tick_format:"region"},y1:{label:"-log10 p-value",label_offset:-28}},data_layers:{positions:{type:"scatter",point_shape:"circle",point_size:40,fields:["id","position","pvalue|scinotation","pvalue|neglog10","refAllele","ld:state"],x_axis:{field:"position"},y_axis:{axis:1,field:"pvalue|neglog10",floor:0,upper_buffer:.05,min_extent:[0,10]},color:{field:"ld:state",scale_function:"numerical_bin",parameters:{breaks:[0,.2,.4,.6,.8],values:["#357ebd","#46b8da","#5cb85c","#eea236","#d43f3a"],null_value:"#B8B8B8"}},tooltip:{divs:[{html:"<strong>{{id}}</strong>"},{html:"P Value: <strong>{{pvalue|scinotation}}</strong>"},{html:"Ref. Allele: <strong>{{refAllele}}</strong>"}]}}}},genes:{width:800,height:225,origin:{x:0,y:350},min_width:400,min_height:112.5,proportional_width:1,proportional_height:.5,proportional_origin:{x:0,y:.5},margin:{top:20,right:20,bottom:20,left:50},axes:{},data_layers:{genes:{type:"genes",fields:["gene:gene"],tooltip:{divs:[{html:"<strong><i>{{gene_name}}</i></strong>"},{html:"Gene ID: <strong>{{gene_id}}</strong>"},{html:"Transcript ID: <strong>{{transcript_id}}</strong>"},{html:'<a href="http://exac.broadinstitute.org/gene/{{gene_id}}" target="_new">ExAC Page</a>'}]}}}}}};
"use strict";LocusZoom.DataSources=function(){this.sources={}},LocusZoom.DataSources.prototype.addSource=function(o,t){function e(o){if(!LocusZoom.KnownDataSources)return null;for(var t=0;t<LocusZoom.KnownDataSources.length;t++){if(!LocusZoom.KnownDataSources[t].SOURCE_NAME)throw"KnownDataSource at position "+t+" does not have a 'SOURCE_NAME' static property";if(LocusZoom.KnownDataSources[t].SOURCE_NAME==o)return LocusZoom.KnownDataSources[t]}return null}if(Array.isArray(t)){var r=e(t[0]);if(!r)throw"Unable to resolve "+t[0]+" data source";this.sources[o]=new r(t[1])}else this.sources[o]=t;return this},LocusZoom.DataSources.prototype.getSource=function(o){return this.sources[o]},LocusZoom.DataSources.prototype.setSources=function(o){"string"==typeof o&&(o=JSON.parse(o));var t=this;return Object.keys(o).forEach(function(e){t.addSource(e,o[e])}),t},LocusZoom.DataSources.prototype.keys=function(){return Object.keys(this.sources)},LocusZoom.DataSources.prototype.toJSON=function(){return this.sources},LocusZoom.Data=LocusZoom.Data||{},LocusZoom.Data.Requester=function(o){function t(o){var t={},e=/^(?:([^:]+):)?([^:\|]*)(\|.+)*$/;return o.forEach(function(o){var r=e.exec(o),s=r[1]||"base",n=r[2],a=LocusZoom.TransformationFunctions.get(r[3]);"undefined"==typeof t[s]&&(t[s]={outnames:[],fields:[],trans:[]}),t[s].outnames.push(o),t[s].fields.push(n),t[s].trans.push(a)}),t}this.getData=function(e,r){for(var s=t(r),n=Object.keys(s).map(function(t){if(!o.getSource(t))throw"Datasource for namespace "+t+" not found";return o.getSource(t).getData(e,s[t].fields,s[t].outnames,s[t].trans)}),a=Q.when({header:{},body:{}}),u=0;u<n.length;u++)a=a.then(n[u]);return a}},LocusZoom.Data.Source=function(){},LocusZoom.Data.Source.prototype.parseInit=function(o){if("string"==typeof o?(this.url=o,this.params={}):(this.url=o.url,this.params=o.params||{}),!this.url)throw"Source not initialized with required URL"},LocusZoom.Data.Source.prototype.getRequest=function(o,t,e){return LocusZoom.createCORSPromise("GET",this.getURL(o,t,e))},LocusZoom.Data.Source.prototype.getData=function(o,t,e,r){return function(s){return this.getRequest(o,s,t).then(function(o){return this.parseResponse(o,s,t,e,r)}.bind(this))}.bind(this)},LocusZoom.Data.Source.prototype.toJSON=function(){return[Object.getPrototypeOf(this).constructor.SOURCE_NAME,{url:this.url,params:this.params}]},LocusZoom.Data.AssociationSource=function(o){this.parseInit(o),this.getData=function(o,t,e,r){return["id","position"].forEach(function(o){-1==t.indexOf(o)&&(t.unshift(o),e.unshift(o),r.unshift(null))}),function(s){return this.getRequest(o,s).then(function(o){return this.parseResponse(o,s,t,e,r)}.bind(this))}.bind(this)}},LocusZoom.Data.AssociationSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.AssociationSource.prototype.constructor=LocusZoom.Data.AssociationSource,LocusZoom.Data.AssociationSource.prototype.getURL=function(o,t,e){var r=o.analysis||t.header.analysis||this.params.analysis||3;return this.url+"results/?filter=analysis in "+r+" and chromosome in  '"+o.chr+"' and position ge "+o.start+" and position le "+o.end},LocusZoom.Data.AssociationSource.prototype.parseResponse=function(o,t,e,r,s){var n=o.data,a=[];e.forEach(function(o){if(!(o in n))throw"field "+o+" not found in response"});for(var u=0;u<n.position.length;u++){for(var c={},i=0;i<e.length;i++){var p=n[e[i]][u];s&&s[i]&&(p=s[i](p)),c[r[i]]=p}a.push(c)}var h={header:t.header||{},body:a};return h},LocusZoom.Data.AssociationSource.SOURCE_NAME="AssociationLZ",LocusZoom.Data.LDSource=function(o){this.parseInit(o),this.params.pvaluefield||(this.params.pvaluefield="pvalue|neglog10"),this.getData=function(o,t,e,r){if(t.length>1)throw"LD currently only supports one field";return function(s){return this.getRequest(o,s,t).then(function(o){return this.parseResponse(o,s,t,e,r)}.bind(this))}.bind(this)}},LocusZoom.Data.LDSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.LDSource.prototype.constructor=LocusZoom.Data.LDSource,LocusZoom.Data.LDSource.prototype.getURL=function(o,t,e){var r=function(o,t,e){t=t||"pvalue",e=e||1;for(var r=o[0][t],s=0,n=1;n<o.length;n++)o[n][t]*e>r&&(r=o[n][t]*e,s=n);return s},s=o.ldrefsource||t.header.ldrefsource||1,n=e[0];if("state"==n&&(n=o.ldrefvar||t.header.ldrefvar||"best"),"best"==n){if(!t.body)throw"No association data found to find best pvalue";n=t.body[r(t.body,this.params.pvaluefield)].id}return t.header||(t.header={}),t.header.ldrefvar=n,this.url+"results/?filter=reference eq "+s+" and chromosome2 eq '"+o.chr+"' and position2 ge "+o.start+" and position2 le "+o.end+" and variant1 eq '"+n+"'&fields=chr,pos,rsquare"},LocusZoom.Data.LDSource.prototype.parseResponse=function(o,t,e,r){var s=function(o,t,e,r){for(var s=0,n=0;s<o.length&&n<t.position2.length;)o[s].position==t.position2[n]?(o[s][e]=t[r][n],s++,n++):o[s].position<t.position2[n]?s++:n++};return s(t.body,o.data,r[0],"rsquare"),t},LocusZoom.Data.LDSource.SOURCE_NAME="LDLZ",LocusZoom.Data.GeneSource=function(o){this.parseInit(o),this.getData=function(o,t,e,r){return function(s){return this.getRequest(o,s,t).then(function(o){return this.parseResponse(o,s,t,e,r)}.bind(this))}.bind(this)}},LocusZoom.Data.GeneSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.GeneSource.prototype.constructor=LocusZoom.Data.GeneSource,LocusZoom.Data.GeneSource.prototype.getURL=function(o,t,e){var r=o.source||t.header.source||this.params.source||2;return this.url+"?filter=source in "+r+" and chrom eq '"+o.chr+"' and start le "+o.end+" and end ge "+o.start},LocusZoom.Data.GeneSource.prototype.parseResponse=function(o,t,e,r){return{header:t.header,body:o.data}},LocusZoom.Data.GeneSource.SOURCE_NAME="GeneLZ",LocusZoom.createResolvedPromise=function(){var o=Q.defer();return o.resolve(Array.prototype.slice.call(arguments)),o.promise},LocusZoom.KnownDataSources=[LocusZoom.Data.AssociationSource,LocusZoom.Data.LDSource,LocusZoom.Data.GeneSource];
"use strict";LocusZoom.Instance=function(t,i,s){return this.initialized=!1,this.id=t,this.svg=null,this.panels={},this.remap_promises=[],"undefined"==typeof s?this.layout=LocusZoom.mergeLayouts(LocusZoom.StandardLayout,LocusZoom.DefaultLayout):this.layout=LocusZoom.mergeLayouts(s,LocusZoom.DefaultLayout),this.state=this.layout.state,this.lzd=new LocusZoom.Data.Requester(i),this.window_onresize=null,this.onUpdate=null,this.triggerOnUpdate=function(){"function"==typeof this.onUpdate&&this.onUpdate()},this.initializeLayout(),this},LocusZoom.Instance.prototype.initializeLayout=function(){if(isNaN(this.layout.width)||this.layout.width<=0)throw"Instance layout parameter `width` must be a positive number";if(isNaN(this.layout.height)||this.layout.height<=0)throw"Instance layout parameter `width` must be a positive number";if(isNaN(this.layout.aspect_ratio)||this.layout.aspect_ratio<=0)throw"Instance layout parameter `aspect_ratio` must be a positive number";"responsive"==this.layout.resizable&&(this.window_onresize=d3.select(window).on("resize.lz-"+this.id,function(){var t=this.svg.node().parentNode.getBoundingClientRect();this.setDimensions(t.width,t.height)}.bind(this)),d3.select(window).on("load.lz-"+this.id,function(){this.setDimensions()}.bind(this))),this.setDimensions();var t;for(t in this.layout.panels)this.addPanel(t,this.layout.panels[t])},LocusZoom.Instance.prototype.setDimensions=function(t,i){return!isNaN(t)&&t>=0&&(this.layout.width=Math.max(Math.round(+t),this.layout.min_width)),!isNaN(i)&&i>=0&&(this.layout.height=Math.max(Math.round(+i),this.layout.min_height)),"responsive"==this.layout.resizable&&(this.svg&&(this.layout.width=Math.max(this.svg.node().parentNode.getBoundingClientRect().width,this.layout.min_width)),this.layout.height=this.layout.width/this.layout.aspect_ratio,this.layout.height<this.layout.min_height&&(this.layout.height=this.layout.min_height,this.layout.width=this.layout.height*this.layout.aspect_ratio)),this.layout.aspect_ratio=this.layout.width/this.layout.height,null!=this.svg&&("responsive"==this.layout.resizable?this.svg.attr("viewBox","0 0 "+this.layout.width+" "+this.layout.height).attr("preserveAspectRatio","xMinYMin meet"):this.svg.attr("width",this.layout.width).attr("height",this.layout.height)),this.positionPanels(),this.initialized&&this.ui.render(),this.triggerOnUpdate(),this},LocusZoom.Instance.prototype.addPanel=function(t,i){if("string"!=typeof t)throw"Invalid panel id passed to LocusZoom.Instance.prototype.addPanel()";if("undefined"!=typeof this.panels[t])throw"Cannot create panel with id ["+t+"]; panel with that id already exists";if("object"!=typeof i)throw"Invalid panel layout passed to LocusZoom.Instance.prototype.addPanel()";var s=new LocusZoom.Panel(t,i,this);this.panels[s.id]=s;var e=[],a=[];for(t in this.panels)e.push(this.panels[t].layout.min_width),a.push(this.panels[t].layout.min_height);return this.layout.min_width=Math.max.apply(null,e),this.layout.min_height=a.reduce(function(t,i){return t+i}),this.setDimensions(),this.panels[s.id]},LocusZoom.Instance.prototype.positionPanels=function(){var t;for(t in this.panels)this.layout.resizable&&(this.panels[t].layout.width=this.panels[t].layout.proportional_width*this.layout.width,this.panels[t].layout.height=this.panels[t].layout.proportional_height*this.layout.height,this.panels[t].layout.origin.x=this.panels[t].layout.proportional_origin.x*this.layout.width,this.panels[t].layout.origin.y=this.panels[t].layout.proportional_origin.y*this.layout.height),this.panels[t].setOrigin(),this.panels[t].setDimensions()},LocusZoom.Instance.prototype.initialize=function(){var t=this.svg.append("g").attr("class","lz-mouse_guide").attr("id",this.id+".mouse_guide"),i=t.append("rect").attr("class","lz-mouse_guide-vertical").attr("x",-1),s=t.append("rect").attr("class","lz-mouse_guide-horizontal").attr("y",-1);this.mouse_guide={svg:t,vertical:i,horizontal:s};var e=this.svg.append("g").attr("class","lz-ui").attr("id",this.id+".ui").style("display","none");this.ui={svg:e,parent:this,is_resize_dragging:!1,show:function(){this.svg.style("display",null)},hide:function(){this.svg.style("display","none")},initialize:function(){if("manual"==this.parent.layout.resizable){this.resize_handle=this.svg.append("g").attr("id",this.parent.id+".ui.resize_handle"),this.resize_handle.append("path").attr("class","lz-ui-resize_handle").attr("d","M 0,16, L 16,0, L 16,16 Z");var t=d3.behavior.drag();t.on("dragstart",function(){this.resize_handle.select("path").attr("class","lz-ui-resize_handle_dragging"),this.is_resize_dragging=!0}.bind(this)),t.on("dragend",function(){this.resize_handle.select("path").attr("class","lz-ui-resize_handle"),this.is_resize_dragging=!1}.bind(this)),t.on("drag",function(){this.setDimensions(this.layout.width+d3.event.dx,this.layout.height+d3.event.dy)}.bind(this.parent)),this.resize_handle.call(t)}this.render()},render:function(){"manual"==this.parent.layout.resizable&&this.resize_handle.attr("transform","translate("+(this.parent.layout.width-17)+", "+(this.parent.layout.height-17)+")")}},this.ui.initialize();var a=this.svg.append("g").attr("class","lz-curtain").style("display","none").attr("id",this.id+".curtain");this.curtain={svg:a,drop:function(t){if(this.svg.style("display",null),"undefined"!=typeof t)try{this.svg.select("text").selectAll("tspan").remove(),t.split("\n").forEach(function(t){this.svg.select("text").append("tspan").attr("x","1em").attr("dy","1.5em").text(t)}.bind(this)),this.svg.select("text").append("tspan").attr("x","1em").attr("dy","2.5em").attr("class","dismiss").text("Dismiss").on("click",function(){this.raise()}.bind(this))}catch(i){console.error("LocusZoom tried to render an error message but it's not a string:",t)}},raise:function(){this.svg.style("display","none")}},this.curtain.svg.append("rect").attr("width","100%").attr("height","100%"),this.curtain.svg.append("text").attr("id",this.id+".curtain_text").attr("x","1em").attr("y","0em");for(var n in this.panels)this.panels[n].initialize();return this.svg.on("mouseover",function(){this.ui.is_resize_dragging||this.ui.show()}.bind(this)),this.svg.on("mouseout",function(){this.ui.is_resize_dragging||this.ui.hide(),this.mouse_guide.vertical.attr("x",-1),this.mouse_guide.horizontal.attr("y",-1)}.bind(this)),this.svg.on("mousemove",function(){var t=d3.mouse(this.svg.node());this.mouse_guide.vertical.attr("x",t[0]),this.mouse_guide.horizontal.attr("y",t[1])}.bind(this)),this.initialized=!0,this},LocusZoom.Instance.prototype.mapTo=function(t,i,s){this.state.chr=+t,this.state.start=+i,this.state.end=+s,this.remap_promises=[];for(var e in this.panels)this.remap_promises.push(this.panels[e].reMap());return Q.all(this.remap_promises)["catch"](function(t){console.log(t),this.curtain.drop(t)}.bind(this)).done(function(){this.triggerOnUpdate()}.bind(this)),this},LocusZoom.Instance.prototype.refresh=function(){this.mapTo(this.state.chr,this.state.start,this.state.end)};
"use strict";LocusZoom.Panel=function(t,i,a){return this.initialized=!1,this.id=t,this.parent=a||null,this.svg={},this.layout=LocusZoom.mergeLayouts(i||{},LocusZoom.Panel.DefaultLayout),this.parent?(this.state=this.parent.state,this.state_id=this.id,this.state[this.state_id]=this.state[this.state_id]||{}):(this.state=null,this.state_id=null),this.data_layers={},this.data_layer_ids_by_z_index=[],this.data_promises=[],this.xExtent=null,this.y1Extent=null,this.y2Extent=null,this.x_ticks=[],this.y1_ticks=[],this.y2_ticks=[],this.getBaseId=function(){return this.parent.id+"."+this.id},this.triggerOnUpdate=function(){this.parent.triggerOnUpdate()},this.initializeLayout(),this},LocusZoom.Panel.DefaultLayout={state:{data_layers:{}},width:0,height:0,origin:{x:0,y:0},min_width:0,min_height:0,proportional_width:1,proportional_height:1,proportional_origin:{x:0,y:0},margin:{top:0,right:0,bottom:0,left:0},cliparea:{height:0,width:0,origin:{x:0,y:0}},axes:{x:{},y1:{},y2:{}}},LocusZoom.Panel.prototype.initializeLayout=function(){if(this.setDimensions(),this.setOrigin(),this.setMargin(),["x","y1","y2"].forEach(function(t){Object.keys(this.layout.axes[t]).length&&this.layout.axes[t].render!==!1?(this.layout.axes[t].render=!0,this.layout.axes[t].label=this.layout.axes[t].label||null,this.layout.axes[t].label_function=this.layout.axes[t].label_function||null,this.layout.axes[t].data_layer_id=this.layout.axes[t].data_layer_id||null):this.layout.axes[t].render=!1}.bind(this)),"object"==typeof this.layout.data_layers){var t;for(t in this.layout.data_layers)this.addDataLayer(t,this.layout.data_layers[t])}},LocusZoom.Panel.prototype.setDimensions=function(t,i){return!isNaN(t)&&t>=0&&(this.layout.width=Math.max(Math.round(+t),this.layout.min_width)),!isNaN(i)&&i>=0&&(this.layout.height=Math.max(Math.round(+i),this.layout.min_height)),this.layout.cliparea.width=this.layout.width-(this.layout.margin.left+this.layout.margin.right),this.layout.cliparea.height=this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),this.initialized&&this.render(),this},LocusZoom.Panel.prototype.setOrigin=function(t,i){return!isNaN(t)&&t>=0&&(this.layout.origin.x=Math.min(Math.max(Math.round(+t),0),this.parent.layout.width)),!isNaN(i)&&i>=0&&(this.layout.origin.y=Math.min(Math.max(Math.round(+i),0),this.parent.layout.height)),this.initialized&&this.render(),this},LocusZoom.Panel.prototype.setMargin=function(t,i,a,s){var e;return!isNaN(t)&&t>=0&&(this.layout.margin.top=Math.max(Math.round(+t),0)),!isNaN(i)&&i>=0&&(this.layout.margin.right=Math.max(Math.round(+i),0)),!isNaN(a)&&a>=0&&(this.layout.margin.bottom=Math.max(Math.round(+a),0)),!isNaN(s)&&s>=0&&(this.layout.margin.left=Math.max(Math.round(+s),0)),this.layout.margin.top+this.layout.margin.bottom>this.layout.height&&(e=Math.floor((this.layout.margin.top+this.layout.margin.bottom-this.layout.height)/2),this.layout.margin.top-=e,this.layout.margin.bottom-=e),this.layout.margin.left+this.layout.margin.right>this.layout.width&&(e=Math.floor((this.layout.margin.left+this.layout.margin.right-this.layout.width)/2),this.layout.margin.left-=e,this.layout.margin.right-=e),this.layout.cliparea.width=this.layout.width-(this.layout.margin.left+this.layout.margin.right),this.layout.cliparea.height=this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),this.layout.cliparea.origin.x=this.layout.margin.left,this.layout.cliparea.origin.y=this.layout.margin.top,this.initialized&&this.render(),this},LocusZoom.Panel.prototype.initialize=function(){this.svg.container=this.parent.svg.insert("svg:g","#"+this.parent.id+"\\.ui").attr("id",this.getBaseId()+".panel_container");var t=this.svg.container.append("clipPath").attr("id",this.getBaseId()+".clip");this.svg.clipRect=t.append("rect"),this.svg.group=this.svg.container.append("g").attr("id",this.getBaseId()+".panel").attr("clip-path","url(#"+this.getBaseId()+".clip)");var i=this.svg.container.append("g").attr("id",this.getBaseId()+".curtain").attr("clip-path","url(#"+this.getBaseId()+".clip)").attr("class","lz-curtain").style("display","none");this.curtain={svg:i,drop:function(t){if(this.svg.style("display",null),"undefined"!=typeof t)try{this.svg.select("text").selectAll("tspan").remove(),t.split("\n").forEach(function(t){this.svg.select("text").append("tspan").attr("x","1em").attr("dy","1.5em").text(t)}.bind(this)),this.svg.select("text").append("tspan").attr("x","1em").attr("dy","2.5em").attr("class","dismiss").text("Dismiss").on("click",function(){this.raise()}.bind(this))}catch(i){console.error("LocusZoom tried to render an error message but it's not a string:",t)}},raise:function(){this.svg.style("display","none")}},this.curtain.svg.append("rect").attr("width","100%").attr("height","100%"),this.curtain.svg.append("text").attr("id",this.getBaseId()+".curtain_text").attr("x","1em").attr("y","0em"),this.layout.inner_border&&(this.inner_border=this.svg.group.append("rect")),this.svg.x_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".x_axis").attr("class","lz-x lz-axis"),this.layout.axes.x.render&&(this.svg.x_axis_label=this.svg.x_axis.append("text").attr("class","lz-x lz-axis lz-label").attr("text-anchor","middle")),this.svg.y1_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".y1_axis").attr("class","lz-y lz-y1 lz-axis"),this.layout.axes.y1.render&&(this.svg.y1_axis_label=this.svg.y1_axis.append("text").attr("class","lz-y1 lz-axis lz-label").attr("text-anchor","middle")),this.svg.y2_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".y2_axis").attr("class","lz-y lz-y2 lz-axis"),this.layout.axes.y2.render&&(this.svg.y2_axis_label=this.svg.y2_axis.append("text").attr("class","lz-y2 lz-axis lz-label").attr("text-anchor","middle"));for(var a in this.data_layers)this.data_layers[a].initialize();return this.initialized=!0,this},LocusZoom.Panel.prototype.addDataLayer=function(t,i){if("string"!=typeof t)throw"Invalid data layer id passed to LocusZoom.Panel.prototype.addDataLayer()";if("object"!=typeof i)throw"Invalid data layer layout passed to LocusZoom.Panel.prototype.addDataLayer()";if("undefined"!=typeof this.data_layers[i.id])throw"Cannot create data layer with id ["+t+"]; data layer with that id already exists";if("string"!=typeof i.type)throw"Invalid data layer type in layout passed to LocusZoom.Panel.prototype.addDataLayer()";var a=LocusZoom.DataLayers.get(i.type,t,i,this);if(this.data_layers[a.id]=a,this.data_layer_ids_by_z_index.push(a.id),i.x_axis?this.xExtent=this.data_layers[a.id].getAxisExtent("x"):this.xExtent=function(){return d3.extent([this.state.start,this.state.end])},i.y_axis){var s="y"+(1==i.y_axis.axis||2==i.y_axis.axis?i.y_axis.axis:1);this[s+"Extent"]=this.data_layers[a.id].getAxisExtent("y"),this.layout.axes[s].data_layer_id=a.id}return this.data_layers[a.id]},LocusZoom.Panel.prototype.reMap=function(){this.data_promises=[];for(var t in this.data_layers)this.data_promises.push(this.data_layers[t].reMap());return Q.all(this.data_promises).then(function(){this.render()}.bind(this))["catch"](function(t){console.log(t),this.curtain.drop(t)}.bind(this))},LocusZoom.Panel.prototype.render=function(){this.svg.container.attr("transform","translate("+this.layout.origin.x+","+this.layout.origin.y+")"),this.svg.clipRect.attr("width",this.layout.width).attr("height",this.layout.height),this.layout.inner_border&&this.inner_border.attr("x",this.layout.margin.left).attr("y",this.layout.margin.top).attr("width",this.layout.width-(this.layout.margin.left+this.layout.margin.right)).attr("height",this.layout.height-(this.layout.margin.top+this.layout.margin.bottom)).style({fill:"transparent","stroke-width":1,stroke:this.layout.inner_border}),"function"==typeof this.xExtent&&(this.x_extent=this.xExtent(),this.layout.axes.x.ticks?this.x_ticks=this.layout.axes.x.ticks:this.x_ticks=LocusZoom.prettyTicks(this.x_extent,"both",this.layout.cliparea.width/120),this.x_scale=d3.scale.linear().domain([this.x_extent[0],this.x_extent[1]]).range([0,this.layout.cliparea.width])),"function"==typeof this.y1Extent&&(this.y1_extent=this.y1Extent(),this.layout.axes.y1.ticks?this.y1_ticks=this.layout.axes.y1.ticks:this.y1_ticks=LocusZoom.prettyTicks(this.y1_extent),this.y1_extent=d3.extent(this.y1_extent.concat(this.y1_ticks)),this.y1_scale=d3.scale.linear().domain([this.y1_extent[0],this.y1_extent[1]]).range([this.layout.cliparea.height,0])),"function"==typeof this.y2Extent&&(this.y2_extent=this.y2Extent(),this.layout.axes.y2.ticks?this.y2_ticks=this.layout.axes.y2.ticks:this.y2_ticks=LocusZoom.prettyTicks(this.y2_extent),this.y2_extent=d3.extent(this.y2_extent.concat(this.y2_ticks)),this.y2_scale=d3.scale.linear().domain([this.y2_extent[0],this.y2_extent[1]]).range([this.layout.cliparea.height,0]));var t=function(t){return"function"==typeof this[t+"_scale"]&&!isNaN(this[t+"_scale"](0))}.bind(this);return this.layout.axes.x.render&&t("x")&&this.renderAxis("x"),this.layout.axes.y1.render&&t("y1")&&this.renderAxis("y1"),this.layout.axes.y2.render&&t("y2")&&this.renderAxis("y2"),this.data_layer_ids_by_z_index.forEach(function(t){this.data_layers[t].draw().render()}.bind(this)),this},LocusZoom.Panel.prototype.renderAxis=function(t){if(-1==["x","y1","y2"].indexOf(t))throw"Unable to render axis; invalid axis identifier: "+t;var i={x:{position:"translate("+this.layout.margin.left+","+(this.layout.height-this.layout.margin.bottom)+")",orientation:"bottom",label_x:this.layout.cliparea.width/2,label_y:this.layout.axes[t].label_offset||0,label_rotate:null},y1:{position:"translate("+this.layout.margin.left+","+this.layout.margin.top+")",orientation:"left",label_x:this.layout.axes[t].label_offset||0,label_y:this.layout.cliparea.height/2,label_rotate:-90},y2:{position:"translate("+(this.layout.width-this.layout.margin.right)+","+this.layout.margin.top+")",orientation:"right",label_x:this.layout.axes[t].label_offset||0,label_y:this.layout.cliparea.height/2,label_rotate:-90}},a=function(t){for(var i=0;i<t.length;i++)if(isNaN(t[i]))return!1;return!0}(this[t+"_ticks"]);if(this[t+"_axis"]=d3.svg.axis().scale(this[t+"_scale"]).orient(i[t].orientation),a)this[t+"_axis"].tickValues(this[t+"_ticks"]),"region"==this.layout.axes[t].tick_format&&this[t+"_axis"].tickFormat(function(t){return LocusZoom.positionIntToString(t)});else{var s=this[t+"_ticks"].map(function(t){return t.x});this[t+"_axis"].tickValues(s).tickFormat(function(i,a){return this[t+"_ticks"][a].text}.bind(this))}if(this.svg[t+"_axis"].attr("transform",i[t].position).call(this[t+"_axis"]),!a){var e=d3.selectAll("g#"+this.getBaseId().replace(".","\\.")+"\\."+t+"_axis g.tick"),o=this;e.each(function(i,a){var s=d3.select(this).select("text");o[t+"_ticks"][a].style&&s.style(o[t+"_ticks"][a].style),o[t+"_ticks"][a].transform&&s.attr("transform",o[t+"_ticks"][a].transform)})}var h=this.layout.axes[t].label||null;this.layout.axes[t].label_function&&(h=LocusZoom.LabelFunctions.get(this.layout.axes[t].label_function,this.state)),null!=h&&(this.svg[t+"_axis_label"].attr("x",i[t].label_x).attr("y",i[t].label_y).text(h),null!=i[t].label_rotate&&this.svg[t+"_axis_label"].attr("transform","rotate("+i[t].label_rotate+" "+i[t].label_x+","+i[t].label_y+")"))};
"use strict";LocusZoom.DataLayer=function(t,i,o){return this.initialized=!1,this.id=t,this.parent=o||null,this.svg={},this.layout=LocusZoom.mergeLayouts(i||{},LocusZoom.DataLayer.DefaultLayout),this.parent?(this.state=this.parent.state,this.state_id=this.parent.id+"."+this.id,this.state[this.state_id]=this.state[this.state_id]||{},this.layout.selectable&&(this.state[this.state_id].selected=this.state[this.state_id].selected||null)):(this.state=null,this.state_id=null),this.data=[],this.metadata={},this.getBaseId=function(){return this.parent.parent.id+"."+this.parent.id+"."+this.id},this.triggerOnUpdate=function(){this.parent.triggerOnUpdate()},this.tooltips={},this.createTooltip=function(t,i){if("object"!=typeof this.layout.tooltip)throw"DataLayer ["+this.id+"] layout does not define a tooltip";if("string"!=typeof i)throw"Unable to create tooltip: id is not a string";if(this.tooltips[i]={data:t,arrow:null,selector:d3.select(this.parent.parent.svg.node().parentNode).append("div").attr("class","lz-data_layer-tooltip").attr("id",this.getBaseId()+".tooltip."+i)},this.layout.tooltip.html)this.tooltips[i].selector.html(LocusZoom.parseFields(t,this.layout.tooltip.html));else if(this.layout.tooltip.divs){var o,s,e;for(o in this.layout.tooltip.divs)s=this.layout.tooltip.divs[o],e=this.tooltips[i].selector.append("div"),s.id&&e.attr("id",s.id),s["class"]&&e.attr("class",s["class"]),s.style&&e.style(s.style),s.html&&e.html(LocusZoom.parseFields(t,s.html))}this.positionTooltip(i)},this.destroyTooltip=function(t){if("string"!=typeof t)throw"Unable to destroy tooltip: id is not a string";this.tooltips[t]&&("object"==typeof this.tooltips[t].selector&&this.tooltips[t].selector.remove(),delete this.tooltips[t])},this.destroyAllTooltips=function(){var t;for(t in this.tooltips)this.destroyTooltip(t)},this.positionTooltip=function(t){if("string"!=typeof t)throw"Unable to position tooltip: id is not a string";this.tooltips[t].selector.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"),this.tooltips[t].arrow||(this.tooltips[t].arrow=this.tooltips[t].selector.append("div").style("position","absolute").attr("class","lz-data_layer-tooltip-arrow_top_left")),this.tooltips[t].arrow.style("left","-1px").style("top","-1px")},this.positionAllTooltips=function(){var t;for(t in this.tooltips)this.positionTooltip(t)},this.getPageOrigin=function(){var t=this.parent.parent.svg.node().getBoundingClientRect(),i=document.documentElement.scrollLeft||document.body.scrollLeft,o=document.documentElement.scrollTop||document.body.scrollTop;return{x:t.left+this.parent.layout.origin.x+this.parent.layout.margin.left+i,y:t.top+this.parent.layout.origin.y+this.parent.layout.margin.top+o}},this},LocusZoom.DataLayer.DefaultLayout={type:"",fields:[]},LocusZoom.DataLayer.prototype.getAxisExtent=function(t){var i=t+"_axis";return function(){var t=d3.extent(this.data,function(t){return+t[this.layout[i].field]}.bind(this)),o=t[1]-t[0];return isNaN(this.layout[i].lower_buffer)||t.push(t[0]-o*this.layout[i].lower_buffer),isNaN(this.layout[i].upper_buffer)||t.push(t[1]+o*this.layout[i].upper_buffer),"object"!=typeof this.layout[i].min_extent||isNaN(this.layout[i].min_extent[0])||isNaN(this.layout[i].min_extent[1])||t.push(this.layout[i].min_extent[0],this.layout[i].min_extent[1]),t=d3.extent(t),isNaN(this.layout[i].floor)||(t[0]=this.layout[i].floor),isNaN(this.layout[i].ceiling)||(t[1]=this.layout[i].ceiling),t}.bind(this)},LocusZoom.DataLayer.prototype.initialize=function(){return this.svg.container=this.parent.svg.group.append("g").attr("id",this.getBaseId()+".data_layer_container"),this.svg.clipRect=this.svg.container.append("clipPath").attr("id",this.getBaseId()+".clip").append("rect"),this.svg.group=this.svg.container.append("g").attr("id",this.getBaseId()+".data_layer").attr("clip-path","url(#"+this.getBaseId()+".clip)"),this.initialized=!0,this},LocusZoom.DataLayer.prototype.draw=function(){return this.svg.container.attr("transform","translate("+this.parent.layout.cliparea.origin.x+","+this.parent.layout.cliparea.origin.y+")"),this.svg.clipRect.attr("width",this.parent.layout.cliparea.width).attr("height",this.parent.layout.cliparea.height),this.positionAllTooltips(),this},LocusZoom.DataLayer.prototype.reMap=function(){this.destroyAllTooltips();var t=this.parent.parent.lzd.getData(this.state,this.layout.fields);return t.then(function(t){this.data=t.body}.bind(this)),t};
"use strict";LocusZoom.LabelFunctions=function(){var t={},e={};return t.get=function(t,a){if(t){if(e[t])return"undefined"==typeof a?e[t]:e[t](a);throw"label function ["+t+"] not found"}return null},t.set=function(t,a){a?e[t]=a:delete e[t]},t.add=function(a,i){if(e[a])throw"label function already exists with name: "+a;t.set(a,i)},t.list=function(){return Object.keys(e)},t}(),LocusZoom.LabelFunctions.add("chromosome",function(t){return isNaN(+t.chr)?"Chromosome (Mb)":"Chromosome "+t.chr+" (Mb)"}),LocusZoom.TransformationFunctions=function(){var t={},e={},a=function(t){if(!t)return null;var a=e[t];if(a)return a;throw"transformation "+t+" not found"},i=function(t){return a(t)},n=function(t){for(var e,a=[],n=/\|([^\|]+)/g;null!=(e=n.exec(t));)a.push(e[1]);return 1==a.length?i(a[0]):a.length>1?function(t){for(var e=t,n=0;n<a.length;n++)e=i(a[n])(e);return e}:null};return t.get=function(t){return t&&"|"==t.substring(0,1)?n(t):i(t)},t.set=function(t,a){if("|"==t.substring(0,1))throw"transformation name should not start with a pipe";a?e[t]=a:delete e[t]},t.add=function(a,i){if(e[a])throw"transformation already exists with name: "+a;t.set(a,i)},t.list=function(){return Object.keys(e)},t}(),LocusZoom.TransformationFunctions.add("neglog10",function(t){return-Math.log(t)/Math.LN10}),LocusZoom.TransformationFunctions.add("scinotation",function(t){if(Math.abs(t)>1)var e=Math.ceil(Math.log(t)/Math.LN10);else var e=Math.floor(Math.log(t)/Math.LN10);return Math.abs(e)<=3?t.toFixed(3):t.toExponential(2).replace("+","").replace("e"," × 10^")}),LocusZoom.ScaleFunctions=function(){var t={},e={};return t.get=function(t,a,i){if(t){if(e[t])return"undefined"==typeof a&&"undefined"==typeof i?e[t]:e[t](a,i);throw"scale function ["+t+"] not found"}return null},t.set=function(t,a){a?e[t]=a:delete e[t]},t.add=function(a,i){if(e[a])throw"scale function already exists with name: "+a;t.set(a,i)},t.list=function(){return Object.keys(e)},t}(),LocusZoom.ScaleFunctions.add("numerical_bin",function(t,e){var a=t.breaks,i=t.values;if(null==e||isNaN(+e))return t.null_value?t.null_value:i[0];var n=a.reduce(function(t,a){return t>+e||+e>=t&&a>+e?t:a});return i[a.indexOf(n)]}),LocusZoom.ScaleFunctions.add("categorical_bin",function(t,e){return-1!=t.categories.indexOf(e)?t.values[t.categories.indexOf(e)]:t.null_value?t.null_value:t.values[0]}),LocusZoom.DataLayers=function(){var t={},e={};return t.get=function(t,a,i,n){if(t){if(e[t]){if("undefined"==typeof a||"undefined"==typeof i)throw"id or layout argument missing for data layer ["+t+"]";return new e[t](a,i,n)}throw"data layer ["+t+"] not found"}return null},t.set=function(t,a){if(a){if("function"!=typeof a)throw"unable to set data layer ["+t+"], argument provided is not a function";e[t]=a,e[t].prototype=new LocusZoom.DataLayer}else delete e[t]},t.add=function(a,i){if(e[a])throw"data layer already exists with name: "+a;t.set(a,i)},t.list=function(){return Object.keys(e)},t}(),LocusZoom.DataLayers.add("scatter",function(t,e,a){return this.DefaultLayout={point_size:40,point_shape:"circle",color:"#888888",y_axis:{axis:1},selectable:!0},e=LocusZoom.mergeLayouts(e,this.DefaultLayout),LocusZoom.DataLayer.apply(this,arguments),this.positionTooltip=function(t){if("string"!=typeof t)throw"Unable to position tooltip: id is not a string";if(!this.tooltips[t])throw"Unable to position tooltip: id does not point to a valid tooltip";var e=this.tooltips[t],a=7,i=1,n=6,s=this.getPageOrigin(),r=this.parent.x_scale(e.data[this.layout.x_axis.field]),l="y"+this.layout.y_axis.axis+"_scale",o=this.parent[l](e.data[this.layout.y_axis.field]),d=e.selector.node().getBoundingClientRect(),c=Math.sqrt(this.layout.point_size/Math.PI);if(r<=this.parent.layout.width/2)var h=s.x+r+c+a+i,u="left",_=-1*(a+i);else var h=s.x+r-d.width-c-a-i,u="right",_=d.width-i;var p=this.parent.layout.height-(this.parent.layout.margin.top+this.parent.layout.margin.bottom);if(o-d.height/2<=0)var g=s.y+o-1.5*a-n,y=n;else if(o+d.height/2>=p)var g=s.y+o+a+n-d.height,y=d.height-2*a-n;else var g=s.y+o-d.height/2,y=d.height/2-a;e.selector.style("left",h+"px").style("top",g+"px"),e.arrow||(e.arrow=e.selector.append("div").style("position","absolute")),e.arrow.attr("class","lz-data_layer-tooltip-arrow_"+u).style("left",_+"px").style("top",y+"px")},this.render=function(){var t=this.svg.group.selectAll("path.lz-data_layer-scatter").data(this.data,function(t){return t.id});if(t.enter().append("path").attr("class","lz-data_layer-scatter"),t.attr("id",function(t){return"s"+t.id.replace(/\W/g,"")}).attr("transform",function(t){var e=this.parent.x_scale(t[this.layout.x_axis.field]),a="y"+this.layout.y_axis.axis+"_scale",i=this.parent[a](t[this.layout.y_axis.field]);return isNaN(e)&&(e=-1e3),isNaN(i)&&(i=-1e3),"translate("+e+","+i+")"}.bind(this)).attr("d",d3.svg.symbol().size(this.layout.point_size).type(this.layout.point_shape)),this.layout.color)switch(typeof this.layout.color){case"string":t.attr("fill",this.layout.color);break;case"object":this.layout.color.scale_function&&this.layout.color.field&&t.attr("fill",function(t){return LocusZoom.ScaleFunctions.get(this.layout.color.scale_function,this.layout.color.parameters||{},t[this.layout.color.field])}.bind(this))}if(this.layout.selectable&&-1!=this.layout.fields.indexOf("id")&&(t.on("mouseover",function(t){var e="s"+t.id.replace(/\W/g,"");this.state[this.state_id].selected!=e&&(d3.select("#"+e).attr("class","lz-data_layer-scatter lz-data_layer-scatter-hovered"),this.layout.tooltip&&this.createTooltip(t,e))}.bind(this)).on("mouseout",function(t){var e="s"+t.id.replace(/\W/g,"");this.state[this.state_id].selected!=e&&(d3.select("#"+e).attr("class","lz-data_layer-scatter"),this.layout.tooltip&&this.destroyTooltip(e))}.bind(this)).on("click",function(t){var e="s"+t.id.replace(/\W/g,"");this.state[this.state_id].selected==e?(this.state[this.state_id].selected=null,d3.select("#"+e).attr("class","lz-data_layer-scatter lz-data_layer-scatter-hovered")):(null!=this.state[this.state_id].selected&&(d3.select("#"+this.state[this.state_id].selected).attr("class","lz-data_layer-scatter"),this.layout.tooltip&&this.destroyTooltip(this.state[this.state_id].selected)),this.state[this.state_id].selected=e,d3.select("#"+e).attr("class","lz-data_layer-scatter lz-data_layer-scatter-selected")),this.triggerOnUpdate()}.bind(this)),null!=this.state[this.state_id].selected)){var e=this.state[this.state_id].selected;if(d3.select("#"+e).empty())console.warn("State elements for "+this.state_id+" contains an ID that is not or is no longer present on the plot: "+this.state[this.state_id].selected),this.state[this.state_id].selected=null;else if(this.tooltips[this.state[this.state_id].selected])this.positionTooltip(this.state[this.state_id].selected);else{this.state[this.state_id].selected=null;var a=d3.select("#"+e).datum();d3.select("#"+e).on("mouseover")(a),d3.select("#"+e).on("click")(a)}}t.exit().remove()},this}),LocusZoom.DataLayers.add("genes",function(t,e,a){return this.DefaultLayout={label_font_size:12,label_exon_spacing:4,exon_height:16,bounding_box_padding:6,track_vertical_spacing:10,selectable:!0},e=LocusZoom.mergeLayouts(e,this.DefaultLayout),LocusZoom.DataLayer.apply(this,arguments),this.getTrackHeight=function(){return 2*this.layout.bounding_box_padding+this.layout.label_font_size+this.layout.label_exon_spacing+this.layout.exon_height+this.layout.track_vertical_spacing},this.transcript_idx=0,this.tracks=1,this.gene_track_index={1:[]},this.assignTracks=function(){return this.getLabelWidth=function(t,e){var a=this.svg.group.append("text").attr("x",0).attr("y",0).attr("class","lz-data_layer-gene lz-label").style("font-size",e).text(t+"→"),i=a.node().getBBox().width;return a.node().remove(),i},this.tracks=1,this.gene_track_index={1:[]},this.data.map(function(t,e){if(this.data[e].gene_id&&this.data[e].gene_id.indexOf(".")){var a=this.data[e].gene_id.split(".");this.data[e].gene_id=a[0],this.data[e].gene_version=a[1]}if(this.data[e].transcript_id=this.data[e].transcripts[this.transcript_idx].transcript_id,this.data[e].display_range={start:this.parent.x_scale(Math.max(t.start,this.state.start)),end:this.parent.x_scale(Math.min(t.end,this.state.end))},this.data[e].display_range.label_width=this.getLabelWidth(this.data[e].gene_name,this.layout.label_font_size),this.data[e].display_range.width=this.data[e].display_range.end-this.data[e].display_range.start,this.data[e].display_range.text_anchor="middle",this.data[e].display_range.width<this.data[e].display_range.label_width){if(t.start<this.state.start)this.data[e].display_range.end=this.data[e].display_range.start+this.data[e].display_range.label_width+this.layout.label_font_size,this.data[e].display_range.text_anchor="start";else if(t.end>this.state.end)this.data[e].display_range.start=this.data[e].display_range.end-this.data[e].display_range.label_width-this.layout.label_font_size,this.data[e].display_range.text_anchor="end";else{var i=(this.data[e].display_range.label_width-this.data[e].display_range.width)/2+this.layout.label_font_size;this.data[e].display_range.start-i<this.parent.x_scale(this.state.start)?(this.data[e].display_range.start=this.parent.x_scale(this.state.start),this.data[e].display_range.end=this.data[e].display_range.start+this.data[e].display_range.label_width,this.data[e].display_range.text_anchor="start"):this.data[e].display_range.end+i>this.parent.x_scale(this.state.end)?(this.data[e].display_range.end=this.parent.x_scale(this.state.end),this.data[e].display_range.start=this.data[e].display_range.end-this.data[e].display_range.label_width,this.data[e].display_range.text_anchor="end"):(this.data[e].display_range.start-=i,this.data[e].display_range.end+=i)}this.data[e].display_range.width=this.data[e].display_range.end-this.data[e].display_range.start}this.data[e].display_range.start-=this.layout.bounding_box_padding,this.data[e].display_range.end+=this.layout.bounding_box_padding,this.data[e].display_range.width+=2*this.layout.bounding_box_padding,this.data[e].display_domain={start:this.parent.x_scale.invert(this.data[e].display_range.start),end:this.parent.x_scale.invert(this.data[e].display_range.end)},this.data[e].display_domain.width=this.data[e].display_domain.end-this.data[e].display_domain.start,this.data[e].track=null;for(var n=1;null==this.data[e].track;){var s=!1;this.gene_track_index[n].map(function(t){if(!s){var e=Math.min(t.display_range.start,this.display_range.start),a=Math.max(t.display_range.end,this.display_range.end);a-e<t.display_range.width+this.display_range.width&&(s=!0)}}.bind(this.data[e])),s?(n++,n>this.tracks&&(this.tracks=n,this.gene_track_index[n]=[])):(this.data[e].track=n,this.gene_track_index[n].push(this.data[e]))}this.data[e].parent=this,this.data[e].transcripts.map(function(t,a){this.data[e].transcripts[a].parent=this.data[e],this.data[e].transcripts[a].exons.map(function(t,i){this.data[e].transcripts[a].exons[i].parent=this.data[e].transcripts[a]}.bind(this))}.bind(this))}.bind(this)),this},this.render=function(){this.assignTracks();var t=this.svg.group.selectAll("g.lz-data_layer-gene").data(this.data,function(t){return t.gene_name});t.enter().append("g").attr("class","lz-data_layer-gene"),t.attr("id",function(t){return"g"+t.gene_name.replace(/\W/g,"")}).each(function(t){var e=t.parent,a=d3.select(this).selectAll("rect.lz-data_layer-gene.lz-bounding_box").filter(".lz-bounding_box").data([t],function(t){return t.gene_name+"_bbox"});a.enter().append("rect").attr("class","lz-data_layer-gene lz-bounding_box"),a.attr("id",function(t){return"g"+t.gene_name.replace(/\W/g,"")+"_bounding_box"}).attr("x",function(t){return t.display_range.start}).attr("y",function(t){return(t.track-1)*e.getTrackHeight()}).attr("width",function(t){return t.display_range.width}).attr("height",function(t){return e.getTrackHeight()-e.layout.track_vertical_spacing}).attr("rx",function(t){return e.layout.bounding_box_padding}).attr("ry",function(t){return e.layout.bounding_box_padding}),a.exit().remove();var i=d3.select(this).selectAll("rect.lz-data_layer-gene.lz-boundary").filter(".lz-boundary").data([t],function(t){return t.gene_name+"_boundary"});i.enter().append("rect").attr("class","lz-data_layer-gene lz-boundary"),i.attr("x",function(t){return e.parent.x_scale(t.start)}).attr("y",function(t){return(t.track-1)*e.getTrackHeight()+e.layout.bounding_box_padding+e.layout.label_font_size+e.layout.label_exon_spacing+Math.max(e.layout.exon_height,3)/2}).attr("width",function(t){return e.parent.x_scale(t.end)-e.parent.x_scale(t.start)}).attr("height",1),i.exit().remove();var n=d3.select(this).selectAll("text.lz-data_layer-gene.lz-label").data([t],function(t){return t.gene_name+"_label"});n.enter().append("text").attr("class","lz-data_layer-gene lz-label"),n.attr("x",function(t){return"middle"==t.display_range.text_anchor?t.display_range.start+t.display_range.width/2:"start"==t.display_range.text_anchor?t.display_range.start+e.layout.bounding_box_padding:"end"==t.display_range.text_anchor?t.display_range.end-e.layout.bounding_box_padding:void 0}).attr("y",function(t){return(t.track-1)*e.getTrackHeight()+e.layout.bounding_box_padding+e.layout.label_font_size}).attr("text-anchor",function(t){return t.display_range.text_anchor}).text(function(t){return"+"==t.strand?t.gene_name+"→":"←"+t.gene_name}).style("font-size",t.parent.layout.label_font_size),n.exit().remove();var s=d3.select(this).selectAll("g.lz-data_layer-gene").filter(".lz-exons").data([t],function(t){return t.gene_name+"_exons"});s.enter().append("g").attr("class","lz-data_layer-gene lz-exons"),s.each(function(t){var a=d3.select(this).selectAll("rect.lz-data_layer-gene.lz-exon").filter(".lz-exon").data(t.transcripts[t.parent.transcript_idx].exons,function(t){return t.exon_id});a.enter().append("rect").attr("class","lz-data_layer-gene lz-exon"),a.attr("x",function(t){return e.parent.x_scale(t.start)}).attr("y",function(){return(t.track-1)*e.getTrackHeight()+e.layout.bounding_box_padding+e.layout.label_font_size+e.layout.label_exon_spacing}).attr("width",function(t){return e.parent.x_scale(t.end)-e.parent.x_scale(t.start)}).attr("height",function(){return e.layout.exon_height}),a.exit().remove()}),s.exit().remove();var r=d3.select(this).selectAll("rect.lz-data_layer-gene.lz-clickarea").filter(".lz-clickarea").data([t],function(t){return t.gene_name+"_clickarea"});if(r.enter().append("rect").attr("class","lz-data_layer-gene lz-clickarea"),r.attr("id",function(t){return"g"+t.gene_name.replace(/\W/g,"")+"_clickarea"}).attr("x",function(t){return t.display_range.start}).attr("y",function(t){return(t.track-1)*e.getTrackHeight()}).attr("width",function(t){return t.display_range.width}).attr("height",function(t){return e.getTrackHeight()-e.layout.track_vertical_spacing}).attr("rx",function(t){return e.layout.bounding_box_padding}).attr("ry",function(t){return e.layout.bounding_box_padding}),t.parent.layout.selectable&&(r.on("mouseover",function(t){var a="g"+t.gene_name.replace(/\W/g,"");e.state[e.state_id].selected!=a&&(d3.select("#"+a+"_bounding_box").attr("class","lz-data_layer-gene lz-bounding_box lz-bounding_box-hovered"),e.layout.tooltip&&e.createTooltip(t,a))}).on("mouseout",function(t){var a="g"+t.gene_name.replace(/\W/g,"");e.state[e.state_id].selected!=a&&(d3.select("#"+a+"_bounding_box").attr("class","lz-data_layer-gene lz-bounding_box"),e.layout.tooltip&&e.destroyTooltip(a))}).on("click",function(t){var a="g"+t.gene_name.replace(/\W/g,"");e.state[e.state_id].selected==a?(e.state[e.state_id].selected=null,d3.select("#"+a+"_bounding_box").attr("class","lz-data_layer-gene lz-bounding_box lz-bounding_box-hovered")):(null!=e.state[e.state_id].selected&&(d3.select("#"+e.state[e.state_id].selected+"_bounding_box").attr("class","lz-data_layer-gene lz-bounding_box"),e.layout.tooltip&&e.destroyTooltip(e.state[e.state_id].selected)),e.state[e.state_id].selected=a,d3.select("#"+a+"_bounding_box").attr("class","lz-data_layer-gene lz-bounding_box lz-bounding_box-selected")),e.triggerOnUpdate()}),null!=t.parent.state[t.parent.state_id].selected)){var l=t.parent.state[t.parent.state_id].selected+"_clickarea";if(d3.select("#"+l).empty())console.warn("Pre-defined state selection for "+t.parent.state_id+" contains an ID that is not or is no longer present on the plot: "+t.parent.state[t.parent.state_id].selected),t.parent.state[t.parent.state_id].selected=null;else if(t.parent.tooltips[t.parent.state[t.parent.state_id].selected])t.parent.positionTooltip(t.parent.state[t.parent.state_id].selected);else{t.parent.state[t.parent.state_id].selected=null;var o=d3.select("#"+l).datum();d3.select("#"+l).on("mouseover")(o),d3.select("#"+l).on("click")(o)}}}),t.exit().remove()},this.positionTooltip=function(t){if("string"!=typeof t)throw"Unable to position tooltip: id is not a string";if(!this.tooltips[t])throw"Unable to position tooltip: id does not point to a valid tooltip";var e=this.tooltips[t],a=7,i=1,n=this.getPageOrigin(),s=e.selector.node().getBoundingClientRect(),r=d3.select("#g"+e.data.gene_name.replace(/\W/g,"")).node().getBBox(),l=this.parent.layout.height-(this.parent.layout.margin.top+this.parent.layout.margin.bottom),o=this.parent.layout.width-(this.parent.layout.margin.left+this.parent.layout.margin.right),d=(e.data.display_range.start+e.data.display_range.end)/2-this.layout.bounding_box_padding/2,c=Math.max(s.width/2-d,0),h=Math.max(s.width/2+d-o,0),u=n.x+d-s.width/2-h+c,_=s.width/2-a/2+h-c;if(s.height+i+a>l-(r.y+r.height))var p=n.y+r.y-(s.height+i+a),g="down",y=s.height-i;else var p=n.y+r.y+r.height+i+a,g="up",y=0-i-a;e.selector.style("left",u+"px").style("top",p+"px"),e.arrow||(e.arrow=e.selector.append("div").style("position","absolute")),e.arrow.attr("class","lz-data_layer-tooltip-arrow_"+g).style("left",_+"px").style("top",y+"px")},this});

        if (typeof define === "function" && define.amd){
            this.LocusZoom = LocusZoom, define(LocusZoom);
        } else if (typeof module === "object" && module.exports) {
            module.exports = LocusZoom;
        } else {
            this.LocusZoom = LocusZoom;
        }

    } catch (plugin_loading_error){
        console.log("LocusZoom Plugin error: " + plugin_loading_error);
    }

}();